<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, updateProfile } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Login function
        async function loginUser(event) {
            event.preventDefault();
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-password").value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                window.location.href = '/archive.html'; // Redirect after successful login
            } catch (error) {
                const errorMessage = error.message;
                displayError(errorMessage); // Display error message
            }
        }

        // Signup function with display name
        async function signupUser(event) {
            event.preventDefault();
            const email = document.getElementById("signup-email").value;
            const password = document.getElementById("signup-password").value;
            const displayName = document.getElementById("display-name").value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Set the display name after signup
                await updateProfile(user, {
                    displayName: displayName,
                });

                // Send email verification after signup
                await sendEmailVerification(user);
                alert('Sign up successful! Please verify your email.');

                window.location.href = '/archive.html'; // Redirect after successful signup
            } catch (error) {
                const errorMessage = error.message;
                displayError(errorMessage); // Display error message
            }
        }

        // Display error messages
        function displayError(errorMessage) {
            const errorContainer = document.getElementById("error-message");
            errorContainer.textContent = errorMessage;
            errorContainer.style.display = 'block'; // Show error
        }
    </script>
</head>
<body>
    <h1>Login / Sign Up</h1>

    <!-- Login Form -->
    <div id="login-form">
        <h2>Login</h2>
        <form id="login-form" onsubmit="loginUser(event)">
            <label for="login-email">Email:</label>
            <input type="email" id="login-email" required>
            <br>

            <label for="login-password">Password:</label>
            <input type="password" id="login-password" required>
            <br>

            <button type="submit">Log In</button>
        </form>
        <br>
        <p>Don't have an account? <button onclick="toggleSignup()">Sign Up</button></p>
    </div>

    <!-- Sign Up Form -->
    <div id="signup-form" style="display: none;">
        <h2>Sign Up</h2>
        <form id="signup-form" onsubmit="signupUser(event)">
            <label for="signup-email">Email:</label>
            <input type="email" id="signup-email" required>
            <br>

            <label for="signup-password">Password:</label>
            <input type="password" id="signup-password" required>
            <br>

            <label for="display-name">Display Name:</label>
            <input type="text" id="display-name" required>
            <br>

            <button type="submit">Sign Up</button>
        </form>
        <br>
        <p>Already have an account? <button onclick="toggleLogin()">Log In</button></p>
    </div>

    <!-- Error Message Display -->
    <div id="error-message" style="color: red; display: none;"></div>

    <script>
        // Function to toggle between login and signup forms
        function toggleSignup() {
            document.getElementById("login-form").style.display = "none";
            document.getElementById("signup-form").style.display = "block";
        }

        function toggleLogin() {
            document.getElementById("login-form").style.display = "block";
            document.getElementById("signup-form").style.display = "none";
        }
    </script>
</body>
</html>
