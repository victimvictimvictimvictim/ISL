<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - ISL Archive</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDoim0HfMd649cWe3wTpLbjiZZP-su6YBU",
            authDomain: "islisl.firebaseapp.com",
            projectId: "islisl",
            storageBucket: "islisl.firebasestorage.app",
            messagingSenderId: "955676281907",
            appId: "1:955676281907:web:808529df880af0aacc2746",
            measurementId: "G-267W98LCC5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Handle login
        async function loginUser(event) {
            event.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                window.location.href = '/archive.html'; // Redirect to archive page
            } catch (error) {
                const errorMessage = error.message;
                displayError(errorMessage); // Display error message
            }
        }

        // Handle sign-up
        async function signupUser(event) {
            event.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                window.location.href = '/archive.html'; // Redirect to archive page after signup
            } catch (error) {
                const errorMessage = error.message;
                displayError(errorMessage); // Display error message
            }
        }

        // Display error message
        function displayError(message) {
            const errorElement = document.getElementById("error-message");
            errorElement.textContent = message;
            errorElement.style.display = "block";
        }

        // Check if the user is already logged in (if they reload the page)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.location.href = '/archive.html'; // Redirect to archive if already logged in
            }
        });

        window.onload = function() {
            document.getElementById("login-form").addEventListener("submit", loginUser);
            document.getElementById("signup-form").addEventListener("submit", signupUser);
        }
    </script>
</head>
<body>
    <h1>Login to ISL Archive</h1>

    <div id="error-message" style="color: red; display: none;"></div>

    <!-- Login Form -->
    <form id="login-form">
        <label for="email">Email:</label>
        <input type="email" id="email" required>
        <br>

        <label for="password">Password:</label>
        <input type="password" id="password" required>
        <br>

        <button type="submit">Login</button>
    </form>

    <p>Don't have an account? <button onclick="showSignupForm()">Sign Up</button></p>

    <!-- Signup Form -->
    <form id="signup-form" style="display: none;">
        <label for="email">Email:</label>
        <input type="email" id="signup-email" required>
        <br>

        <label for="password">Password:</label>
        <input type="password" id="signup-password" required>
        <br>

        <button type="submit">Sign Up</button>
    </form>

    <script>
        // Toggle between Login and Signup forms
        function showSignupForm() {
            document.getElementById("login-form").style.display = "none";
            document.getElementById("signup-form").style.display = "block";
        }
    </script>
</body>
</html>
